"main";let Joi;_f6a‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);let myCart;_f6a‍.w("../schemas",[["myCart",["myCart"],function(v){myCart=v}]]);let Cart,Product;_f6a‍.w("../models",[["Cart",["Cart"],function(v){Cart=v}],["Product",["Product"],function(v){Product=v}]]);let Auth;_f6a‍.w("../auth",[["*",null,function(v){Auth=v}]]);
// import mongoose from 'mongoose'
// import { UserInputError } from 'apollo-server-express'




_f6a‍.d({
  Cart: {
    product: ({ productId }, args, context, info) => {
      return Product.findById(productId)
    }
  },
  Mutation: {
    addToCart: async (root, { productId, quantity }, { req }, info) => {
      // TODO: not auth, validation
      Auth.checkSignedIn(req)
      const cartData = {
        productId, quantity, userId: req.session.userId
      }
      await Joi.validate(cartData, myCart, { abortEarly: false })
      return Cart.create(cartData)
    },
    deleteToCart: async (root, { id }, { req }, info) => {
      // TODO: not auth, validation
      Auth.checkSignedIn(req)
      return Cart.deleteOne({ id })
    },
    updateQuantity: async (root, { id, quantity }, { req }, info) => {
      // TODO: not auth, validation
      Auth.checkSignedIn(req)
      await Cart.findOneAndUpdate(id, { quantity })
      return true
    }
  }
});
